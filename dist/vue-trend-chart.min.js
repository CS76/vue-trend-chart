!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self)["vue-trend-chart"]=e()}(this,function(){"use strict";function t(t){var e=t.split(" ").filter(function(t){return""!==t}).map(function(t){return parseInt(t)});switch(e.length){case 4:return{top:e[0],right:e[1],bottom:e[2],left:e[3]};case 3:return{top:e[0],right:e[1],bottom:e[2],left:e[1]};case 2:return{top:e[0],right:e[1],bottom:e[0],left:e[1]};default:return{top:e[0],right:e[0],bottom:e[0],left:e[0]}}}var s={name:"TrendChartGrid",props:{xAxes:{default:!1,type:Boolean},xAxesLines:{type:Number},yAxes:{default:!1,type:Boolean},yAxesLines:{type:Number}},computed:{xLines:function(){return this.xAxesLines||this.$parent.params.maxAmount},yLines:function(){return this.yAxesLines||this.$parent.labels.yLabelsAmount},boundary:function(){return this.$parent.boundary}},methods:{setXLineParams:function(t){var e=this.boundary,a=this.xLines,i=1<a?(e.maxX-e.minX)/(a-1):0,s=e.minX+i*(t-1);return{x1:s,x2:s,y1:e.minY,y2:e.maxY,stroke:"rgba(0,0,0,0.1)"}},setYLineParams:function(t){var e=this.boundary,a=this.yLines,i=1<a?(e.maxY-e.minY)/(a-1):0,s=e.maxY-i*(t-1);return{x1:e.minX,x2:e.maxX,y1:s,y2:s,stroke:"rgba(0,0,0,0.1)"}}},render:function(t){if(this.xAxes||this.yAxes){var e=[];if(this.xAxes&&0<this.xLines){for(var a=[],i=1;i<=this.xLines;i++)a.push(t("line",{class:"vtc-axis-x",attrs:Object.assign({},this.setXLineParams(i))}));e.push(t("g",{class:"vtc-axes-x"},a))}if(this.yAxes&&0<this.yLines){for(var s=[],n=1;n<=this.yLines;n++)s.push(t("line",{class:"vtc-axis-y",attrs:Object.assign({},this.setYLineParams(n))}));e.push(t("g",{class:"vtc-axes-y"},s))}return t("g",e)}}},n={name:"TrendChartLabels",props:{xLabels:{type:Array},yLabels:{type:Number},yLabelsTextFormatter:{default:function(t){return t},type:Function}},data:function(){return{xLabelHeight:null,yLabelHeight:null}},computed:{boundary:function(){return this.$parent.boundary}},methods:{setXLabelsParams:function(t){var e=this.boundary,a=this.xLabels,i=(e.maxX-e.minX)/(a.length-1);return{transform:"translate("+(e.minX+i*t)+", "+e.maxY+")"}},setYLabelsParams:function(t){var e=this.boundary,a=this.yLabels,i=(e.maxY-e.minY)/(a-1);return{transform:"translate("+e.minX+", "+(e.maxY-i*t)+")"}}},mounted:function(){this.xLabels&&this.xLabels.length&&(this.xLabelHeight=document.querySelector(".vtc-labels-x text").getBoundingClientRect().height),this.yLabels&&0<this.yLabels&&(this.yLabelHeight=document.querySelector(".vtc-labels-y text").getBoundingClientRect().height)},render:function(a){var i=this;if(this.xLabels&&this.xLabels.length||this.yLabels&&0<this.yLabels){var t=[];if(this.xLabels&&this.xLabels.length&&t.push(a("g",{class:"vtc-labels-x"},this.xLabels.map(function(t,e){return a("g",{class:"vtc-label-x",attrs:Object.assign({},i.setXLabelsParams(e))},[a("text",{attrs:{dy:i.xLabelHeight+5,"text-anchor":"middle"}},t),a("line",{attrs:{stroke:"black",y2:5}})])}))),this.yLabels&&0<this.yLabels){for(var e=[],s=0;s<this.yLabels;s++)e.push(a("g",{class:"vtc-label-y",attrs:Object.assign({},this.setYLabelsParams(s))},[a("text",{attrs:{dx:-10,dy:this.yLabelHeight/4,"text-anchor":"end"}},this.yLabelsTextFormatter(this.$parent.params.minValue+(this.$parent.params.maxValue-this.$parent.params.minValue)/(this.yLabels-1)*s)),a("line",{attrs:{stroke:"black",x1:0,x2:-5}})]));t.push(a("g",{class:"vtc-labels-y"},e))}return a("g",t)}}};var r={name:"TrendChartCurve",props:{data:{required:!0,type:Array},className:{type:String},smooth:{default:!1,type:Boolean},stroke:{default:!0,type:Boolean},fill:{default:!1,type:Boolean},showPoints:{default:!1,type:Boolean}},computed:{points:function(){return function(t,e,a,i,s){var n=e.minX,r=e.minY,h=e.maxX,o=e.maxY;t=t.map(function(t){return"number"==typeof t?t:t.value});var l=i-.001,u=(h-n)/(s-1),c=(o-r)/(a+.001-l);return t.map(function(t,e){return{x:e*u+n,y:o-(t-l)*c+1e-5*+(e===s-1)-1e-5*+(0===e)}})}(this.data,this.$parent.boundary,this.$parent.params.maxValue,this.$parent.params.minValue,this.$parent.params.maxAmount)},paths:function(){return function(t,i,e){var a=e.maxY,s=[].concat(t),n=s.shift(),r=s[s.length-1],h=(s[0].x-n.x)/2,o="M "+n.x+","+n.y;s.forEach(function(t,e){if(i){var a=s[e-1]||n;o+=" C "+(h+a.x)+","+a.y+" "+(h+a.x)+","+t.y+" "+t.x+","+t.y}else o+=" L"+t.x+","+t.y});var l=o;return r.Y!==a&&(l+=" L"+r.x+","+a),n.Y!==a&&(l+=" L"+n.x+","+a),{linePath:o,fillPath:l+=" Z"}}(this.points,this.smooth,this.$parent.boundary)}},render:function(a){var i=this,t=[];return this.fill&&this.paths&&this.paths.fillPath&&t.push(a("path",{class:"vtc-curve-fill",attrs:{d:this.paths.fillPath,fill:"rgba(0,0,0,0.15)"}})),this.stroke&&this.paths&&this.paths.linePath&&t.push(a("path",{class:"vtc-curve-stroke",attrs:{d:this.paths.linePath,fill:"none",stroke:"black"}})),this.showPoints&&this.points&&t.push(a("g",{class:"vtc-points"},this.points.map(function(t,e){return a("circle",{class:{"vtc-point":!0,"is-active":i.$parent.activeLineParams&&i.$parent.activeLineParams.index===e},attrs:{cx:t.x,cy:t.y,r:2,stroke:"#000000","stroke-width":1}})}))),a("g",{class:this.className},t)}},e={name:"TrendChart",components:{TrendChartGrid:s,TrendChartLabels:n,TrendChartCurve:r},props:{datasets:{required:!0,type:Array},grid:{default:null,type:Object},labels:{default:null,type:Object},max:{type:Number},min:{type:Number},padding:{default:"5",type:String,validator:function(t){return!((e=t.split(" ").filter(function(t){return""!==t}).map(function(t){return parseInt(t)})).length<1||4<e.length)&&e.every(function(t){return"number"==typeof t&&0<=t});var e}},hoverable:{default:!1,type:Boolean}},data:function(){return{width:null,height:null,labelsOverflowObject:{top:0,right:0,bottom:0,left:0},activeLine:null,activeLineParams:null}},computed:{paddingObject:function(){return this.padding?t(this.padding):t("0")},boundary:function(){var t=this.width,e=this.height,a=this.paddingObject,i=this.labelsOverflowObject,s={minX:a.left+i.left,minY:a.top+i.top,maxX:t-a.right-i.right,maxY:e-a.bottom-i.bottom};return s},params:function(){var s=-1/0,n=1/0,r=0;return this.datasets.forEach(function(t){var e=t.data.map(function(t){return"number"==typeof t?t:t.value}),a=Math.max.apply(Math,e);s<a&&(s=a);var i=Math.min.apply(Math,e);i<n&&(n=i),e.length>r&&(r=e.length)}),void 0!==this.max&&this.max>s&&(s=this.max),void 0!==this.min&&this.min<n&&(n=this.min),{maxValue:s,minValue:n,maxAmount:r}},chartOverlayParams:function(){var t=this.boundary,e=t.maxX-t.minX,a=t.maxY-t.minY;return{x:t.minX,y:t.minY,width:0<e?e:0,height:0<a?a:0,opacity:0}},chartAxesXCoords:function(){for(var t=[],e=(this.boundary.maxX-this.boundary.minX)/(this.params.maxAmount-1),a=0;a<this.params.maxAmount;a++)t.push(e*a+this.boundary.minX);return t}},methods:{setSize:function(){var t=this.$refs.chart.getBoundingClientRect();this.width=t.width,this.height=t.height},fitLabels:function(){var t=this.$refs.chart,e=this.$refs["chart-labels"];if(e&&(e.xLabels&&e.xLabels.length||0<e.yLabelsAmount)){var a=t.getBoundingClientRect(),i=e.$el.getBoundingClientRect(),s=a.top-i.top+this.paddingObject.top,n=i.right-a.right+this.paddingObject.right,r=i.bottom-a.bottom+this.paddingObject.bottom,h=this.paddingObject.left-i.left+a.left;this.labelsOverflowObject={top:0<s?s:0,right:0<n?n:0,bottom:0<r?r:0,left:0<h?h:0}}else this.labelsOverflowObject={top:0,right:0,bottom:0,left:0}},init:function(){var t=this;this.setSize(),this.$nextTick(function(){t.fitLabels()})},getNearestCoordinate:function(a){return this.chartAxesXCoords.reduce(function(t,e){return Math.abs(t)>Math.abs(e-a)?e-a:t},1/0)+a},onWindowResize:function(){this.setSize()},onMouseMove:function(t){var e=this.$refs.chart.getBoundingClientRect();this.activeLine=this.getNearestCoordinate(t.clientX-e.left)},onMouseOut:function(){this.activeLine=null,this.activeLineParams=null}},watch:{activeLine:function(t){var e=this,a=[];if(t){var i=this.$refs.chart.getBoundingClientRect();this.activeLineParams={top:this.boundary.minY+i.top,left:this.boundary.minX+i.left+this.activeLine,height:this.boundary.maxY-this.boundary.minY,index:this.chartAxesXCoords.indexOf(this.activeLine)},this.datasets.forEach(function(t){a.push(t.data[e.activeLineParams.index])})}this.$emit("onMouseMove",this.activeLineParams?Object.assign({},this.activeLineParams,{data:a}):null)}},mounted:function(){this.init(),window.addEventListener("resize",this.onWindowResize)},destroyed:function(){window.removeEventListener("resize",this.onWindowResize)},render:function(e){var a=this,i=[];return this.grid&&i.push(e(s,{class:"vtc-grid",attrs:Object.assign({},this.grid)})),this.hoverable&&this.chartOverlayParams&&this.activeLine&&i.push(e("line",{class:"vtc-active-line",ref:"chart-active-line",attrs:{x1:this.activeLine,x2:this.activeLine,y1:this.boundary.minY,y2:this.boundary.maxY,stroke:"black"}})),this.labels&&i.push(e(n,{class:"vtc-labels",ref:"chart-labels",attrs:Object.assign({},this.labels)})),this.datasets.map(function(t){i.push(e(r,{class:"vtc-curve",attrs:Object.assign({},t)}))}),this.hoverable&&this.chartOverlayParams&&i.push(e("rect",{ref:"chart-hover-area",attrs:Object.assign({},this.chartOverlayParams),on:{mousemove:function(t){return a.onMouseMove(t)},mouseout:function(){return a.onMouseOut()}}})),e("svg",{class:"vtc",ref:"chart",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%"}},i)},install:function(t){t.component(e.name,e)}};return"undefined"!=typeof window&&window.Vue&&window.Vue.use(e),e});
